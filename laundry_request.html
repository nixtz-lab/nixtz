<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nixtz | Laundry Request</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nixtz-primary': '#4F46E5', // Indigo/Blue
                        'nixtz-secondary': '#10B981', // Emerald/Green
                        'nixtz-bg': '#0F172A', // Very dark background (Slate 900)
                        'nixtz-card': '#1E293B', // Dark card background (Slate 800)
                        'status-pending': '#FBBF24', // Amber 500
                        'status-pickedup': '#3B82F6', // Blue 500
                        'status-progress': '#8B5CF6', // Violet 500
                        'status-ready': '#10B981', // Emerald 500
                        'status-complete': '#22C55E', // Green 500
                        'status-cancelled': '#EF4444', // Red 500
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], },
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-nixtz-bg font-sans min-h-screen flex flex-col text-white">

    <header class="bg-nixtz-bg shadow-2xl sticky top-0 z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <a href="business_dashboard.html" title="Back to Dashboard">
                    <img
                        src="images/nixtz_logo.png"
                        alt="Nixtz Logo"
                        class="h-10 w-auto rounded-md"
                        onerror="this.src='https://placehold.co/40x40/4F46E5/ffffff?text=N'"
                    >
                    <span class="text-xl font-bold text-white ml-2">Laundry Service</span>
                </a>
                
                <a href="laundry_staff.html" id="staff-panel-button" style="display: none;" 
                   class="bg-nixtz-secondary hover:bg-[#0da070] text-white font-semibold py-1.5 px-4 rounded-full shadow-lg transition duration-300 text-sm border border-gray-700">
                    Staff Panel
                </a>
            </div>
            
            <div class="flex items-center space-x-4">
                
                <div id="auth-buttons-container" class="flex items-center space-x-4 sm:space-x-6">
                    <a href="service_auth.html" class="bg-gray-800 hover:bg-gray-700 text-white font-bold py-1.5 px-4 rounded-full shadow-lg transition duration-300 transform hover:scale-105 border border-gray-700 text-sm">
                        Login
                    </a>
                </div>
                
                <div id="user-menu-container" class="relative group hidden"> 
                    
                    <button id="user-display-button" 
                            onclick="toggleUserDropdown()"
                            class="flex items-center space-x-2 p-2 rounded-full bg-nixtz-card border border-gray-600 hover:bg-gray-700 transition duration-200">
                        <i data-lucide="user" class="w-5 h-5 text-nixtz-secondary"></i>
                        <span id="username-display" class="font-semibold text-sm text-gray-200">User</span>
                    </button>

                    <div id="user-dropdown" 
                         style="display: none;"
                         class="absolute right-0 top-full mt-3 w-48 bg-gray-800 rounded-xl shadow-xl border border-gray-700/50 p-2 z-50">
                        
                        <a href="user_profile.html" class="w-full flex items-center text-left text-sm text-gray-300 hover:text-white transition duration-200 font-medium py-2 px-3 rounded-lg hover:bg-gray-700">
                            <i data-lucide="user-circle" class="w-4 h-4 mr-2 inline"></i> User Profile
                        </a>
                        
                        <a href="change_password.html" class="w-full flex items-center text-left text-sm text-gray-300 hover:text-white transition duration-200 font-medium py-2 px-3 rounded-lg hover:bg-gray-700">
                            <i data-lucide="key" class="w-4 h-4 mr-2 inline"></i> Change Password
                        </a>

                        <button id="logout-button" onclick="window.handleServiceLogout()" 
                                class="w-full flex items-center text-left text-sm text-red-400 hover:text-red-500 transition duration-200 font-medium py-2 px-3 rounded-lg hover:bg-gray-700 mt-2 border-t border-gray-700/50">
                            <i data-lucide="log-out" class="w-4 h-4 mr-2 inline"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
            </div>
    </header>
    <div id="message-box" class="fixed top-4 right-4 bg-nixtz-primary text-white p-4 rounded-lg shadow-2xl z-[9999] hidden opacity-0 transition-opacity duration-300">
        <p id="message-text" class="font-semibold"></p>
    </div>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">
        <h1 class="text-3xl font-extrabold mb-8 text-center text-nixtz-secondary">Submit New Laundry Request</h1>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-nixtz-card rounded-xl shadow-2xl p-6 border border-gray-700 h-fit">
                <h2 class="text-xl font-bold mb-4 text-white">Request Details</h2>
                <form id="laundry-request-form" class="space-y-4">
                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-400 mb-1">Requesting Department/Room</label>
                        <input type="text" id="department" required class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-nixtz-primary transition" placeholder="e.g., Housekeeping, Room 305">
                    </div>
                    <div>
                        <label for="contact-ext" class="block text-sm font-medium text-gray-400 mb-1">Contact Extension/Number</label>
                        <input type="text" id="contact-ext" required class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:border-nixtz-primary transition" placeholder="e.g., 202 or 081-123-4567">
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-400 mb-1">Special Instructions (Optional)</label>
                        <textarea id="notes" rows="3" class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white resize-none focus:border-nixtz-primary transition" placeholder="e.g., Stains on uniforms, deliver before 5 PM"></textarea>
                    </div>

                    <h3 class="text-lg font-bold pt-4 pb-2 border-t border-gray-700 mt-4">Items for Cleaning</h3>
                    <div id="items-container" class="space-y-3">
                        </div>
                    <button type="button" id="add-item-btn" class="flex items-center text-nixtz-primary hover:text-white transition text-sm font-semibold">
                        <i data-lucide="plus-circle" class="w-4 h-4 mr-1"></i> Add Another Item Type
                    </button>
                    
                    <button type="submit" class="w-full py-3 mt-6 bg-nixtz-primary hover:bg-[#3f3bbf] text-white font-bold rounded-lg shadow-lg transition">
                        Submit Request
                    </button>
                </form>
            </div>

            <div class="lg:col-span-2 bg-nixtz-card rounded-xl shadow-2xl p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4 text-white">Your Request History</h2>
                <div id="request-history-list" class="space-y-4 max-h-[70vh] overflow-y-auto pr-2">
                    <p class="text-gray-500 text-center py-8" id="history-loading-msg">Loading request history...</p>
                </div>
            </div>
        </div>
    </main>
    
    <script src="service_script.js"></script>
    <script src="auth_script.js"></script> 
    <script src="laundry_request.js"></script>
    
    <script>
        // Function to toggle the user dropdown menu
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            if (dropdown) {
                // Toggles visibility
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
        }
        
        // Listen for clicks outside the dropdown to close it
        document.addEventListener('click', function(event) {
            const userContainer = document.getElementById('user-menu-container');
            const dropdown = document.getElementById('user-dropdown');
            const displayButton = document.getElementById('user-display-button');

            // Only hide if the click was not on the button AND the menu is currently visible
            if (dropdown && dropdown.style.display === 'block' && 
                userContainer && !userContainer.contains(event.target) && 
                !displayButton.contains(event.target)) {
                
                dropdown.style.display = 'none';
            }
        });

        // Function to initialize the user banner (To be placed in auth_script.js or run here)
        function checkAuthStatusAndDisplay() {
            // NOTE: This logic needs to be defined based on the core auth keys (nixtz_auth_token)
            const token = localStorage.getItem('nixtz_auth_token');
            const username = localStorage.getItem('nixtz_username');
            const staffRole = localStorage.getItem('nixtz_service_user_role'); // Check for service role too

            const loginButtons = document.getElementById('auth-buttons-container');
            const userMenu = document.getElementById('user-menu-container');
            const usernameDisplay = document.getElementById('username-display');
            const staffPanelButton = document.getElementById('staff-panel-button');

            if (token && username) {
                // Logged In: Show user menu, hide login buttons
                if (loginButtons) loginButtons.style.display = 'none';
                if (userMenu) userMenu.style.display = 'flex';
                if (usernameDisplay) usernameDisplay.textContent = username;
                
                // Show Staff Panel button if user has a service role
                if (staffPanelButton && staffRole && ['standard', 'admin', 'superadmin'].includes(staffRole)) {
                    staffPanelButton.style.display = 'block';
                } else if (staffPanelButton) {
                    staffPanelButton.style.display = 'none';
                }
                
            } else {
                // Not Logged In: Show login buttons, hide user menu
                if (loginButtons) loginButtons.style.display = 'flex';
                if (userMenu) userMenu.style.display = 'none';
                if (staffPanelButton) staffPanelButton.style.display = 'none';
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            
            // This function is executed here using the assumption that it exists globally 
            // from auth_script.js (or we define it here, which we will do for safety).
            checkAuthStatusAndDisplay();
        });
    </script>
</body>
</html>